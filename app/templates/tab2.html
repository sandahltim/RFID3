{% extends "base.html" %}

{% block content %}

    
    <h2 class="tab-title">Open Contracts</h2>

    
    {% if error %}
    
        Error loading contracts: {{ error }}
    

    {% endif %}
    
    	<table class="table table-bordered table-hover category-table" id="category-table">
            <thead class="thead-dark">
                <tr>
                    <th onclick="window.sortContracts('contract_number')">Contract Number <span class="sort-arrow"></span></th>
                    <th onclick="window.sortContracts('client_name')">Customer Name <span class="sort-arrow"></span></th>
                    <th>Items on Contract</th>
                    <th>Total Items in Inventory</th>
                    <th onclick="window.sortContracts('scan_date')">Last Scanned Date <span class="sort-arrow"></span></th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="category-rows">
                {% if contracts %}
                    {% for contract in contracts %}
                        <tr>
                            <td>{{ contract.contract_number }}</td>
                            <td>{{ contract.client_name }}</td>
                            <td>{{ contract.items_on_contract }}</td>
                            <td>{{ contract.total_items_inventory }}</td>
                            <td>{{ contract.scan_date }}</td>
                            <td>
                                <button class="btn btn-sm btn-secondary expand-btn" data-target-id="common-{{ contract.contract_number|replace(' ', '_') }}" data-contract-number="{{ contract.contract_number }}">Expand</button>
                                <button class="btn btn-sm btn-secondary collapse-btn" data-collapse-target="common-{{ contract.contract_number|replace(' ', '_') }}" style="display:none;">Collapse</button>
                                <button class="btn btn-sm btn-info print-btn" data-print-level="Contract" data-print-id="common-{{ contract.contract_number|replace(' ', '_') }}" data-category="{{ contract.contract_number }}">Print</button>
                                <div id="loading-common-{{ contract.contract_number|replace(' ', '_') }}" style="display:none;" class="loading-indicator">Loading...</div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="6">
                                <div id="common-{{ contract.contract_number|replace(' ', '_') }}" class="expandable collapsed subcategory-container"></div>
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6">No open contracts found. Please try refreshing or check data synchronization.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    

{% endblock %}