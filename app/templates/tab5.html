{% extends "base.html" %}

{% block title %}Resale/Rental Packs{% endblock %}

{% block extra_head %}
    <!-- Version: 2025-08-14-v3
         - Added item-level container and loading indicator for dynamic row rendering.
         - Shows fallback row when no categories are available. -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tab5.css') }}">
{% endblock %}

{% block content %}
    <!-- Section: Resale/Rental Packs Header -->
    <h2 class="tab-title">Resale/Rental Packs</h2>

    <div class="card">
        <div class="card-body">
            <div class="btn-group">
                <button class="btn btn-primary" onclick="tab5.updateResalePackToSold()">Update Resale/Pack to Sold</button>
                <a class="btn btn-success" href="{{ url_for('tab5.export_sold_items_csv') }}">Export Sold Items CSV</a>
            </div>
        </div>
    </div>

    <table class="table table-bordered table-hover category-table" id="category-table">
        <thead class="thead-dark">
            <tr>
                <th>Category</th>
                <th>Subcategory</th>
                <th>Total Items</th>
                <th>Items on Contracts</th>
                <th>Items in Service</th>
                <th>Items Available</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for category in categories %}
                <tr class="category-row">
                    <td>{{ category.category }}</td>
                    <td>
                        <select class="subcategory-select" data-category="{{ category.category }}" onchange="tab5.loadCommonNames(this)">
                            <option value="">Select a subcategory</option>
                        </select>
                    </td>
                    <td>{{ category.total_items }}</td>
                    <td>{{ category.items_on_contracts }}</td>
                    <td>{{ category.items_in_service }}</td>
                    <td>{{ category.items_available }}</td>
                    <td>
                        <button class="btn btn-sm btn-info print-btn" data-print-level="Contract" data-print-id="category-{{ category.cat_id }}">Print</button>
                    </td>
                </tr>
            {% endfor %}
            {% if not categories %}
                <tr><td colspan="7">No data available</td></tr>
            {% endif %}
        </tbody>
    </table>

    <!-- Placeholder for dynamically loaded item-level data -->
    <div id="item-level-container" class="item-level-wrapper"></div>
    <div id="loading-indicator" class="loading-indicator" style="display: none;">Loading...</div>

{% endblock %}