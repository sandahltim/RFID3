{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block extra_head %}
<style>
    .loading { color: #888; font-style: italic; }
    .table-bordered th, .table-bordered td { border: 1px solid #dee2e6; }
</style>
<script>
    function triggerFullRefresh() {
        const button = document.getElementById('full-refresh-btn');
        button.disabled = true;
        button.innerText = 'Refreshing...';
        
        fetch('/full_refresh', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert(data.message);
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error during full refresh:', error);
            alert('Failed to perform full refresh');
        })
        .finally(() => {
            button.disabled = false;
            button.innerText = 'Full Refresh';
        });
    }
</script>
{% endblock %}

{% block content %}
<h1>RFID Dashboard</h1>
{% if error %}
    <div class="alert alert-danger">{{ error }}</div>
{% else %}
    <div class="row mb-3">
        <div class="col-md-12">
            <button id="full-refresh-btn" class="btn btn-primary" onclick="triggerFullRefresh()">Full Refresh</button>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <h3>Total Items: {{ total_items }}</h3>
            <h4>Status Breakdown</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody>
                    {% for status, count in status_counts %}
                    <tr>
                        <td>{{ status or 'Unknown' }}</td>
                        <td>{{ count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="col-md-6">
            <h4>Recent Scans</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Tag ID</th>
                        <th>Common Name</th>
                        <th>Last Scanned</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in recent_scans %}
                    <tr>
                        <td>{{ item.tag_id }}</td>
                        <td>{{ item.common_name }}</td>
                        <td>{{ item.date_last_scanned }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Tab</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tab_num in range(1, 7) %}
                    <tr>
                        <td>Tab {{ tab_num }}</td>
                        <td>
                            <a href="/tab/{{ tab_num }}" class="btn btn-primary">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endif %}
{% endblock %}