<!-- Refresh Status Overlay -->
<div id="refresh-status-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; color: white;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: #fff; color: #333; padding: 30px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
        <div style="font-size: 24px; margin-bottom: 15px;">ðŸ”„ System Update in Progress</div>
        <div style="font-size: 16px; margin-bottom: 10px;">Refreshing inventory data from API...</div>
        <div class="spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; margin: 20px auto;"></div>
        <div style="font-size: 14px; color: #666;">This may take a few minutes. Please wait...</div>
        <div style="font-size: 12px; color: #999; margin-top: 10px;">Started at: <span id="refresh-start-time"></span></div>
    </div>
</div>

<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<script>
// Check refresh status periodically
function checkRefreshStatus() {
    fetch('/refresh_status')
        .then(response => response.json())
        .then(data => {
            const overlay = document.getElementById('refresh-status-overlay');
            if (data.refreshing) {
                overlay.style.display = 'block';
                const startTime = document.getElementById('refresh-start-time');
                if (data.start_time) {
                    startTime.textContent = new Date(data.start_time).toLocaleTimeString();
                }
            } else {
                overlay.style.display = 'none';
            }
        })
        .catch(error => {
            console.error('Error checking refresh status:', error);
        });
}

// Check status on page load and every 5 seconds
document.addEventListener('DOMContentLoaded', function() {
    // Skip refresh status popup on analytics pages (tab 7 and others)
    const isAnalyticsPage = window.location.pathname.includes('/tab/7') || 
                           window.location.pathname.includes('/predictive') || 
                           window.location.pathname.includes('/analytics');
    
    if (!isAnalyticsPage) {
        checkRefreshStatus();
        setInterval(checkRefreshStatus, 5000);
    }
});
</script>
